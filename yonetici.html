<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0a0f1a">
<title>YÃ¶netici Paneli</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ FIREBASE YAPILANDIRMASI â€” forman.html ile AYNI olmalÄ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey:            "AIzaSyDc2rOMIFbChvazGogASKxRMRhURpgbghc",
  authDomain:        "uretim-takip-9eca3.firebaseapp.com",
  databaseURL:       "https://uretim-takip-9eca3-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:         "uretim-takip-9eca3",
  storageBucket:     "uretim-takip-9eca3.appspot.com",
  messagingSenderId: "163887042763",
  appId:             "1:163887042763:web:2f39c545dfa1df2a60cb4e"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// YARDIMCI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function today(){
  return new Date().toLocaleDateString('tr-TR',{day:'2-digit',month:'2-digit',year:'numeric'}).replace(/\//g,'.');
}
function todayFull(){
  return new Date().toLocaleDateString('tr-TR',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
}
function dateKey(d){ return (d||today()).replace(/\./g,'-'); }

function showToast(msg, ok=true){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.style.background=ok?'var(--success)':'var(--danger)';
  t.classList.add('show');
  clearTimeout(t._t);
  t._t=setTimeout(()=>t.classList.remove('show'),2800);
}
function showLoading(v){ document.getElementById('loading').style.display=v?'flex':'none'; }
function showModal(title,html){ document.getElementById('modal-title').textContent=title; document.getElementById('modal-body').innerHTML=html; document.getElementById('modal').classList.add('open'); }
function closeModal(){ document.getElementById('modal').classList.remove('open'); }
window.closeModal=closeModal;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DURUM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let S = {
  yonetici: null,
  personel: [],
  atolyeler: [],
  musteriler: [],
  siparisler: [],
  isPlani: {},      // dateKey â†’ {id: {...}}
  gunlukGiris: {},  // dateKey â†’ {formanId: {...}}
  maliyet: {},
  tab: 'dashboard',
  _atolyeSirasi: [],
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BAÅLANGIÃ‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function init(){
  showLoading(true);
  try {
    // Personel
    const pSnap = await get(ref(db,'personel'));
    if(pSnap.exists()){
      S.personel = Object.entries(pSnap.val()).map(([id,v])=>({id,...v}));
    } else {
      const ornek = {
        1:{ad:'Ahmet YÄ±lmaz',rol:'Operator',ucret:80,aktif:true},
        2:{ad:'Fatma Demir',rol:'Operator',ucret:80,aktif:true},
        3:{ad:'Ali Åahin',rol:'Operator',ucret:80,aktif:true},
        4:{ad:'Zeynep Kaya',rol:'Operator',ucret:80,aktif:true},
        5:{ad:'Hasan Kurt',rol:'Operator',ucret:80,aktif:true},
        6:{ad:'Merve Ã‡etin',rol:'Operator',ucret:80,aktif:true},
        7:{ad:'Emre YÄ±ldÄ±z',rol:'Operator',ucret:80,aktif:true},
        8:{ad:'Selin Kara',rol:'Operator',ucret:80,aktif:true},
      };
      await set(ref(db,'personel'),ornek);
      S.personel = Object.entries(ornek).map(([id,v])=>({id:parseInt(id),...v}));
    }

    // AtÃ¶lyeler
    const aSnap = await get(ref(db,'atolyeler'));
    if(aSnap.exists()){
      S.atolyeler = Object.entries(aSnap.val()).map(([id,v])=>({id,...v}));
    } else {
      const ornek = {
        A1:{ad:'AtÃ¶lye 1',aciklama:'Kesim'},
        A2:{ad:'AtÃ¶lye 2',aciklama:'Ä°ÅŸleme'},
        A3:{ad:'AtÃ¶lye 3',aciklama:'Montaj'},
      };
      await set(ref(db,'atolyeler'),ornek);
      S.atolyeler = Object.entries(ornek).map(([id,v])=>({id,...v}));
    }

    // MÃ¼ÅŸteriler
    const mSnap = await get(ref(db,'musteriler'));
    if(mSnap.exists()){
      S.musteriler = Object.entries(mSnap.val()).map(([id,v])=>({id,...v}));
    } else {
      const ornek = {M1:{ad:'MÃ¼ÅŸteri A'},M2:{ad:'MÃ¼ÅŸteri B'},M3:{ad:'MÃ¼ÅŸteri C'}};
      await set(ref(db,'musteriler'),ornek);
      S.musteriler = Object.entries(ornek).map(([id,v])=>({id,...v}));
    }

    // SipariÅŸler
    const sSnap = await get(ref(db,'siparisler'));
    S.siparisler = sSnap.exists() ? Object.entries(sSnap.val()).map(([id,v])=>({id,...v})) : [];

    // Formanlar (login iÃ§in)
    const fSnap = await get(ref(db,'formanlar'));
    const formanlar = fSnap.exists() ? Object.entries(fSnap.val()).map(([id,v])=>({id,...v})) : [];
    const fSel = document.getElementById('login-user');
    fSel.innerHTML='<option value="">SeÃ§iniz...</option>';
    formanlar.forEach(f=>{ fSel.innerHTML+=`<option value="${f.id}">${f.ad}</option>`; });
    fSel.innerHTML+='<option value="Y0">YÃ¶netici (Tam EriÅŸim)</option>';

  } catch(e){
    showToast('BaÄŸlantÄ± hatasÄ±!',false);
    console.error(e);
  }
  showLoading(false);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function doLogin(){
  const uid = document.getElementById('login-user').value;
  if(!uid){ showToast('LÃ¼tfen seÃ§im yapÄ±n',false); return; }
  S.yonetici = uid==='Y0' ? {id:'Y0',ad:'YÃ¶netici'} : {id:uid,ad:'YÃ¶netici'};
  document.getElementById('login').classList.add('out');
  document.getElementById('main').classList.remove('hidden');
  document.getElementById('tb-user').textContent = S.yonetici.ad;
  document.getElementById('tb-date').textContent = todayFull();
  await loadTodayData();
  goTab('dashboard');
  startRealtime();
}

function doLogout(){
  S.yonetici=null;
  document.getElementById('main').classList.add('hidden');
  document.getElementById('login').classList.remove('out');
}

async function loadTodayData(){
  // BugÃ¼nkÃ¼ iÅŸ planÄ±
  const ipSnap = await get(ref(db,`isPlani/${dateKey()}`));
  S.isPlani[dateKey()] = ipSnap.exists() ? ipSnap.val() : {};
  // BugÃ¼nkÃ¼ forman giriÅŸleri
  const ggSnap = await get(ref(db,`gunlukGiris/${dateKey()}`));
  S.gunlukGiris[dateKey()] = ggSnap.exists() ? ggSnap.val() : {};
  // BugÃ¼nkÃ¼ maliyet
  const malSnap = await get(ref(db,'maliyet'));
  S.maliyet = malSnap.exists() ? malSnap.val() : {};
}

function startRealtime(){
  // Forman giriÅŸleri canlÄ± izle
  onValue(ref(db,`gunlukGiris/${dateKey()}`), snap=>{
    S.gunlukGiris[dateKey()] = snap.exists() ? snap.val() : {};
    if(S.tab==='dashboard') goTab('dashboard');
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function goTab(tab){
  S.tab=tab;
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('nav-'+tab)?.classList.add('active');
  const body=document.getElementById('main-body');
  body.innerHTML=''; body.scrollTop=0;
  showLoading(true);

  if(tab==='siparisler'||tab==='isplani'||tab==='raporlar'){
    const sSnap=await get(ref(db,'siparisler'));
    S.siparisler=sSnap.exists()?Object.entries(sSnap.val()).map(([id,v])=>({id,...v})):[];
  }

  if(tab==='dashboard') renderDashboard(body);
  else if(tab==='siparisler') renderSiparisler(body);
  else if(tab==='isplani') renderIsPlani(body);
  else if(tab==='personel') renderPersonel(body);
  else renderRaporlar(body);
  showLoading(false);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard(body){
  const girisler = Object.values(S.gunlukGiris[dateKey()]||{});
  const tumIsler = girisler.flatMap(g=>Object.values(g.isler||{}));
  const toplamUretilen = tumIsler.reduce((s,i)=>s+(i.gerceklesen||0),0);
  const toplamPlan = Object.values(S.isPlani[dateKey()]||{}).reduce((s,i)=>s+(i.planlanan||0),0);
  const aktifPersonel = [...new Set(girisler.flatMap(g=>g.personelIds||[]))].length;
  const bugunMaliyet = Object.values(S.maliyet||{}).filter(m=>m.tarih===today()).reduce((s,m)=>s+(m.toplam||0),0);
  const oran = toplamPlan>0?Math.round(toplamUretilen/toplamPlan*100):0;

  body.innerHTML=`
  <div class="fade-up">
    <div class="sec-title">BugÃ¼n â€” ${today()}</div>
    <div class="stats-row">
      <div class="stat-box gold"><div class="stat-num">${toplamUretilen.toLocaleString('tr')}</div><div class="stat-lbl">Ãœretilen</div>
        <div class="prog-wrap"><div class="prog-bar gold" style="width:${Math.min(oran,100)}%"></div></div>
        <div style="font-size:10px;color:var(--accent);font-weight:700;margin-top:4px">${oran}% hedefe</div>
      </div>
      <div class="stat-box cyan"><div class="stat-num">${toplamPlan.toLocaleString('tr')}</div><div class="stat-lbl">GÃ¼nlÃ¼k Plan</div></div>
      <div class="stat-box green"><div class="stat-num">${aktifPersonel}</div><div class="stat-lbl">Aktif Personel</div></div>
      <div class="stat-box yellow"><div class="stat-num" style="font-size:18px">â‚º${Math.round(bugunMaliyet/1000||0)}K</div><div class="stat-lbl">Maliyet</div></div>
    </div>

    <div class="sec-title">CanlÄ± Forman GiriÅŸleri <span style="display:inline-flex;align-items:center;gap:4px;font-size:10px;color:var(--success);font-weight:600;text-transform:none;letter-spacing:0"><span style="width:6px;height:6px;border-radius:50%;background:var(--success);animation:blink 1.5s infinite"></span>CANLI</span></div>
    ${girisler.length===0
      ?`<div class="empty"><div class="empty-icon">ğŸ“­</div><div class="empty-text">HenÃ¼z forman giriÅŸi yok</div></div>`
      :girisler.map(g=>{
        const isler=Object.values(g.isler||{});
        const gercek=isler.reduce((s,i)=>s+(i.gerceklesen||0),0);
        const plan=isler.reduce((s,i)=>s+(i.planlanan||0),0);
        const pct=plan>0?Math.round(gercek/plan*100):0;
        return `<div class="card" style="cursor:pointer" onclick="formanDetay('${g.formanId||g.forman}')">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
            <div><div style="font-size:14px;font-weight:700">${g.forman}</div>
            <div style="font-size:11px;color:var(--text2);margin-top:2px">${(g.personelAdlar||[]).slice(0,3).join(', ')}${(g.personelAdlar||[]).length>3?` +${(g.personelAdlar||[]).length-3}`:''}</div></div>
            <span class="badge ${pct>=100?'badge-green':'badge-gold'}">${pct}%</span>
          </div>
          <div class="prog-wrap"><div class="prog-bar ${pct>=100?'green':'gold'}" style="width:${Math.min(pct,100)}%"></div></div>
          <div style="display:flex;justify-content:space-between;margin-top:6px;font-size:11px;color:var(--text2)">
            <span>Ãœretilen: <b style="color:var(--accent2)">${gercek}</b></span>
            <span>${(g.personelIds||[]).length} personel Â· ${isler.length} iÅŸ</span>
          </div>
        </div>`;
      }).join('')}

    <div class="sec-title">BugÃ¼n Ä°ÅŸ PlanÄ± <span class="sec-action" onclick="isEkleModal()">+ Ekle</span></div>
    ${Object.values(S.isPlani[dateKey()]||{}).length===0
      ?`<div class="empty"><div class="empty-icon">ğŸ“‹</div><div class="empty-text">BugÃ¼n iÃ§in iÅŸ planlanmamÄ±ÅŸ</div><button class="btn btn-gold btn-full" style="margin-top:12px" onclick="isEkleModal()">Ä°ÅŸ Planla</button></div>`
      :Object.values(S.isPlani[dateKey()]||{}).map(is=>`
        <div class="card" style="border-left:3px solid ${is.oncelik==='YÃ¼ksek'?'var(--danger)':'var(--success)'}">
          <div style="display:flex;justify-content:space-between">
            <div><div style="font-size:13px;font-weight:600">${is.urun}</div>
            <div style="font-size:10px;color:var(--text3);font-family:'JetBrains Mono',monospace">${is.siparis} Â· ${is.atolye||'TÃ¼m'}</div></div>
            <span class="badge ${is.oncelik==='YÃ¼ksek'?'badge-red':'badge-green'}">${is.planlanan} adet</span>
          </div>
        </div>`).join('')}
    <div style="height:20px"></div>
  </div>`;
}

function formanDetay(formanId){
  const g = Object.values(S.gunlukGiris[dateKey()]||{}).find(x=>x.formanId===formanId||x.forman===formanId);
  if(!g) return;
  const isler=Object.values(g.isler||{});
  showModal(g.forman+' â€” GÃ¼nlÃ¼k Rapor',`
    <div class="info-tr"><span class="info-k">Personel</span><span class="info-v">${(g.personelAdlar||[]).length} kiÅŸi</span></div>
    <div style="display:flex;flex-wrap:wrap;gap:5px;margin:8px 0 12px">
      ${(g.personelAdlar||[]).map(ad=>`<span style="background:rgba(0,229,255,.1);border:1px solid rgba(0,229,255,.2);border-radius:16px;padding:3px 10px;font-size:11px;color:var(--accent2)">${ad}</span>`).join('')}
    </div>
    ${isler.map(i=>{const pct=i.planlanan>0?Math.round((i.gerceklesen||0)/i.planlanan*100):0;return`
      <div style="background:var(--bg3);border-radius:10px;padding:10px;margin-bottom:8px">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px">
          <span style="font-size:13px;font-weight:600">${i.urun}</span>
          <span class="badge ${pct>=100?'badge-green':'badge-gold'}">${i.gerceklesen||0}/${i.planlanan}</span>
        </div>
        <div class="prog-wrap"><div class="prog-bar ${pct>=100?'green':'gold'}" style="width:${Math.min(pct,100)}%"></div></div>
        ${i.not?`<div style="font-size:11px;color:var(--warn);margin-top:6px">ğŸ“Œ ${i.not}</div>`:''}
      </div>`;}).join('')}
    <button class="btn btn-outline btn-full" style="margin-top:12px" onclick="closeModal()">Kapat</button>
  `);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SÄ°PARÄ°ÅLER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSiparisler(body){
  body.innerHTML=`
  <div class="fade-up">
    <div class="sec-title">SipariÅŸler <span class="sec-action" onclick="siparisEkleModal()">+ Yeni</span></div>
    ${S.siparisler.length===0
      ?`<div class="empty"><div class="empty-icon">ğŸ“¦</div><div class="empty-text">HenÃ¼z sipariÅŸ yok</div><button class="btn btn-gold btn-full" style="margin-top:12px" onclick="siparisEkleModal()">Ä°lk SipariÅŸi Ekle</button></div>`
      :S.siparisler.map(s=>{
        const tÃ¼mIsler=Object.values(S.maliyet||{}).filter(m=>m.siparis===s.id);
        const uretilen=tÃ¼mIsler.reduce((sum,m)=>sum,0); // maliyet Ã¼zerinden deÄŸil giris Ã¼zerinden
        const gercekUretilen = Object.values(S.gunlukGiris).flatMap(gd=>Object.values(gd)).flatMap(g=>Object.values(g.isler||{})).filter(i=>i.siparis===s.id).reduce((s,i)=>s+(i.gerceklesen||0),0);
        const pct=s.toplam>0?Math.min(Math.round(gercekUretilen/s.toplam*100),100):0;
        const mal=Object.values(S.maliyet||{}).filter(m=>m.siparis===s.id).reduce((s,m)=>s+(m.toplam||0),0);
        return `<div class="card" style="margin-bottom:10px;cursor:pointer" onclick="siparisDetay('${s.id}')">
          <div style="position:absolute;top:0;left:0;right:0;height:2px;background:${s.durum==='TamamlandÄ±'?'var(--success)':s.durum==='Bekliyor'?'var(--text3)':'var(--accent)'}"></div>
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
            <div><div style="font-size:14px;font-weight:700">${s.urun}</div>
            <div style="font-size:10px;color:var(--text3);font-family:'JetBrains Mono',monospace;margin-top:2px">${s.id} Â· ${s.musteri}</div></div>
            <span class="badge ${s.durum==='TamamlandÄ±'?'badge-green':s.durum==='Bekliyor'?'badge-gray':'badge-gold'}">${s.durum}</span>
          </div>
          <div class="prog-wrap"><div class="prog-bar ${pct>=100?'green':'gold'}" style="width:${pct}%"></div></div>
          <div style="display:flex;justify-content:space-between;margin-top:6px;font-size:11px;color:var(--text2)">
            <span><b style="color:var(--accent2)">${gercekUretilen}</b> / ${s.toplam} adet Â· %${pct}</span>
            <span>ğŸ“… ${s.termin}</span>
          </div>
          <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:8px">
            ${(s.atolyeSirasi||[]).map((a,i)=>`<span style="background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:2px 8px;font-size:10px;color:var(--text2)">${a}</span>${i<(s.atolyeSirasi||[]).length-1?'<span style="color:var(--text3);font-size:11px">â€º</span>':''}`).join('')}
          </div>
        </div>`;}).join('')}
    <div style="height:20px"></div>
  </div>`;
}

function siparisDetay(id){
  const s=S.siparisler.find(x=>x.id===id); if(!s) return;
  const gercek=Object.values(S.gunlukGiris).flatMap(gd=>Object.values(gd)).flatMap(g=>Object.values(g.isler||{})).filter(i=>i.siparis===id).reduce((s,i)=>s+(i.gerceklesen||0),0);
  const mal=Object.values(S.maliyet||{}).filter(m=>m.siparis===id).reduce((s,m)=>s+(m.toplam||0),0);
  const pct=s.toplam>0?Math.min(Math.round(gercek/s.toplam*100),100):0;
  showModal(s.urun,`
    <div style="display:flex;gap:8px;margin-bottom:12px">
      <div class="stat-box gold" style="flex:1;padding:10px"><div class="stat-num" style="font-size:20px">${gercek}</div><div class="stat-lbl">Ãœretilen</div></div>
      <div class="stat-box cyan" style="flex:1;padding:10px"><div class="stat-num" style="font-size:20px">${Math.max(0,s.toplam-gercek)}</div><div class="stat-lbl">Kalan</div></div>
    </div>
    <div class="prog-wrap" style="margin-bottom:12px"><div class="prog-bar ${pct>=100?'green':'gold'}" style="width:${pct}%"></div></div>
    <div class="info-tr"><span class="info-k">SipariÅŸ No</span><span class="info-v" style="font-family:'JetBrains Mono',monospace">${s.id}</span></div>
    <div class="info-tr"><span class="info-k">MÃ¼ÅŸteri</span><span class="info-v">${s.musteri}</span></div>
    <div class="info-tr"><span class="info-k">Hedef</span><span class="info-v">${s.toplam} adet</span></div>
    <div class="info-tr"><span class="info-k">Termin</span><span class="info-v">${s.termin}</span></div>
    <div class="info-tr"><span class="info-k">Toplam Maliyet</span><span class="info-v" style="color:var(--accent)">â‚º${Math.round(mal).toLocaleString('tr')}</span></div>
    <div class="info-tr"><span class="info-k">Durum</span><span class="badge ${s.durum==='TamamlandÄ±'?'badge-green':s.durum==='Bekliyor'?'badge-gray':'badge-gold'}">${s.durum}</span></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:16px">
      <button class="btn btn-cyan" onclick="closeModal();isEkleModalSiparis('${id}')">ğŸ“‹ Ä°ÅŸ Planla</button>
      <button class="btn btn-outline" onclick="durumDegistir('${id}')">ğŸ”„ Durum</button>
    </div>
    <button class="btn btn-outline btn-full" style="margin-top:8px" onclick="closeModal()">Kapat</button>
  `);
}

async function durumDegistir(id){
  const s=S.siparisler.find(x=>x.id===id); if(!s) return;
  const sira=['Bekliyor','Devam','TamamlandÄ±'];
  s.durum=sira[(sira.indexOf(s.durum)+1)%sira.length];
  await set(ref(db,`siparisler/${id}/durum`),s.durum);
  closeModal(); showToast(`${id} â†’ ${s.durum}`); goTab('siparisler');
}

function siparisEkleModal(){
  const atolyeTagler=S.atolyeler.map(a=>`<span class="tag" id="st-${a.id}" onclick="toggleATag('${a.id}','${a.ad}')">${a.ad}</span>`).join('');
  const musteriOpts=S.musteriler.map(m=>`<option value="${m.ad}">${m.ad}</option>`).join('');
  S._atolyeSirasi=[];
  showModal('Yeni SipariÅŸ',`
    <div class="form-row"><label class="f-label">SipariÅŸ No</label><input class="f-input" id="s-no" placeholder="SIP-004"></div>
    <div class="form-row"><label class="f-label">MÃ¼ÅŸteri</label><select class="f-input" id="s-musteri">${musteriOpts}</select></div>
    <div class="form-row"><label class="f-label">ÃœrÃ¼n</label><input class="f-input" id="s-urun" placeholder="ÃœrÃ¼n adÄ±..."></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="form-row"><label class="f-label">Adet</label><input class="f-input" type="number" id="s-adet" value="100"></div>
      <div class="form-row"><label class="f-label">Termin</label><input class="f-input" id="s-termin" placeholder="31.03.2025"></div>
    </div>
    <div class="form-row"><label class="f-label">AtÃ¶lye SÄ±rasÄ± (SÄ±rayla SeÃ§)</label>
      <div class="tag-group">${atolyeTagler}</div>
      <div style="font-size:11px;color:var(--text3);margin-top:6px" id="atolye-sira">HenÃ¼z seÃ§ilmedi</div>
    </div>
    <button class="btn btn-gold btn-full" onclick="kaydetSiparis()">SipariÅŸi Kaydet</button>
    <button class="btn btn-outline btn-full" style="margin-top:8px" onclick="closeModal()">Ä°ptal</button>
  `);
}

function toggleATag(id,ad){
  const el=document.getElementById('st-'+id);
  const idx=S._atolyeSirasi.indexOf(ad);
  if(idx>=0){S._atolyeSirasi.splice(idx,1);el.classList.remove('selected');}
  else{S._atolyeSirasi.push(ad);el.classList.add('selected');}
  document.getElementById('atolye-sira').textContent=S._atolyeSirasi.length>0?S._atolyeSirasi.join(' â†’ '):'HenÃ¼z seÃ§ilmedi';
}

async function kaydetSiparis(){
  const no=document.getElementById('s-no').value.trim();
  const urun=document.getElementById('s-urun').value.trim();
  if(!no||!urun){showToast('SipariÅŸ no ve Ã¼rÃ¼n adÄ± zorunlu!',false);return;}
  if(S._atolyeSirasi.length===0){showToast('En az 1 atÃ¶lye seÃ§in!',false);return;}
  showLoading(true);
  try{
    const siparis={
      id:no, musteri:document.getElementById('s-musteri').value,
      urun, toplam:parseInt(document.getElementById('s-adet').value)||100,
      termin:document.getElementById('s-termin').value,
      atolyeSirasi:[...S._atolyeSirasi], durum:'Devam', tarih:today()
    };
    await set(ref(db,`siparisler/${no}`),siparis);
    closeModal(); showToast(`${no} eklendi âœ“`); goTab('siparisler');
  }catch(e){showToast('KayÄ±t hatasÄ±!',false);}
  showLoading(false);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ä°Å PLANI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderIsPlani(body){
  const ipSnap=await get(ref(db,`isPlani/${dateKey()}`));
  S.isPlani[dateKey()]=ipSnap.exists()?ipSnap.val():{};
  const isler=Object.values(S.isPlani[dateKey()]||{});
  const girisler=Object.values(S.gunlukGiris[dateKey()]||{});

  body.innerHTML=`
  <div class="fade-up">
    <div class="sec-title">Ä°ÅŸ PlanÄ± â€” ${today()} <span class="sec-action" onclick="isEkleModal()">+ Ekle</span></div>
    ${isler.length===0
      ?`<div class="empty"><div class="empty-icon">ğŸ“‹</div><div class="empty-text">BugÃ¼n iÃ§in iÅŸ planlanmamÄ±ÅŸ</div><button class="btn btn-gold btn-full" style="margin-top:12px" onclick="isEkleModal()">Ä°lk Ä°ÅŸi Ekle</button></div>`
      :isler.map(is=>{
        const gercek=girisler.flatMap(g=>Object.values(g.isler||{})).filter(i=>i.siparis===is.siparis).reduce((s,i)=>s+(i.gerceklesen||0),0);
        const pct=is.planlanan>0?Math.round(gercek/is.planlanan*100):0;
        return `<div class="card" style="margin-bottom:8px;border-left:3px solid ${is.oncelik==='YÃ¼ksek'?'var(--danger)':'var(--accent2)'}">
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <div><div style="font-size:13px;font-weight:700">${is.urun}</div>
            <div style="font-size:10px;color:var(--text3);font-family:'JetBrains Mono',monospace;margin-top:2px">${is.siparis}${is.atolye?' Â· '+is.atolye:''}</div></div>
            <div style="display:flex;gap:6px;align-items:center">
              <span class="badge ${is.oncelik==='YÃ¼ksek'?'badge-red':'badge-gold'}">${is.planlanan}</span>
              <button onclick="isPlaniSil('${is.id}')" style="background:none;border:none;color:var(--text3);font-size:18px;cursor:pointer;line-height:1;padding:0">Ã—</button>
            </div>
          </div>
          <div class="prog-wrap" style="margin-top:8px"><div class="prog-bar ${pct>=100?'green':'gold'}" style="width:${Math.min(pct,100)}%"></div></div>
          <div style="display:flex;justify-content:space-between;margin-top:5px;font-size:10px;color:var(--text2)">
            <span>GerÃ§ekleÅŸen: <b style="color:${pct>=100?'var(--success)':'var(--accent)'}">${gercek}</b></span>
            <span>%${pct}</span>
          </div>
          ${is.aciklama?`<div style="font-size:11px;color:var(--warn);margin-top:6px">ğŸ“Œ ${is.aciklama}</div>`:''}
        </div>`;}).join('')}
    <div style="height:20px"></div>
  </div>`;
}

function isEkleModal(){ isEkleModalSiparis(''); }
function isEkleModalSiparis(seciliSipId){
  const sipOpts=S.siparisler.filter(s=>s.durum!=='TamamlandÄ±').map(s=>`<option value="${s.id}" ${s.id===seciliSipId?'selected':''}>${s.id} â€” ${s.urun}</option>`).join('');
  const atolyeOpts=S.atolyeler.map(a=>`<option value="${a.ad}">${a.ad}</option>`).join('');
  showModal('Ä°ÅŸ PlanÄ± Ekle',`
    <div class="form-row"><label class="f-label">Tarih</label><input class="f-input" id="ip-tarih" value="${today()}"></div>
    <div class="form-row"><label class="f-label">SipariÅŸ</label><select class="f-input" id="ip-siparis">${sipOpts}</select></div>
    <div class="form-row"><label class="f-label">AtÃ¶lye (Ä°steÄŸe BaÄŸlÄ±)</label><select class="f-input" id="ip-atolye"><option value="">TÃ¼m AtÃ¶lyeler</option>${atolyeOpts}</select></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="form-row"><label class="f-label">Adet</label><input class="f-input" type="number" id="ip-adet" value="100"></div>
      <div class="form-row"><label class="f-label">Ã–ncelik</label><select class="f-input" id="ip-oncelik"><option>Normal</option><option>YÃ¼ksek</option></select></div>
    </div>
    <div class="form-row"><label class="f-label">AÃ§Ä±klama</label><input class="f-input" id="ip-aciklama" placeholder="Ä°steÄŸe baÄŸlÄ±..."></div>
    <button class="btn btn-gold btn-full" onclick="kaydetIsPlan()">Kaydet</button>
    <button class="btn btn-outline btn-full" style="margin-top:8px" onclick="closeModal()">Ä°ptal</button>
  `);
}

async function kaydetIsPlan(){
  const sipId=document.getElementById('ip-siparis').value;
  const sip=S.siparisler.find(s=>s.id===sipId);
  if(!sipId){showToast('SipariÅŸ seÃ§in!',false);return;}
  showLoading(true);
  try{
    const id='IP_'+Date.now();
    const plan={
      id, tarih:document.getElementById('ip-tarih').value,
      siparis:sipId, urun:sip?.urun||'',
      atolye:document.getElementById('ip-atolye').value,
      planlanan:parseInt(document.getElementById('ip-adet').value)||100,
      oncelik:document.getElementById('ip-oncelik').value,
      aciklama:document.getElementById('ip-aciklama').value,
      durum:'Aktif'
    };
    const dk=dateKey(plan.tarih);
    await set(ref(db,`isPlani/${dk}/${id}`),plan);
    if(!S.isPlani[dk]) S.isPlani[dk]={};
    S.isPlani[dk][id]=plan;
    closeModal(); showToast('Ä°ÅŸ planÄ± eklendi âœ“'); goTab('isplani');
  }catch(e){showToast('KayÄ±t hatasÄ±!',false);}
  showLoading(false);
}

async function isPlaniSil(id){
  if(!confirm('Bu iÅŸ kalemini silmek istiyor musunuz?')) return;
  await remove(ref(db,`isPlani/${dateKey()}/${id}`));
  delete S.isPlani[dateKey()][id];
  showToast('Silindi'); goTab('isplani');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSONEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPersonel(body){
  body.innerHTML=`
  <div class="fade-up">
    <div class="sec-title">Personel Havuzu <span class="sec-action" onclick="personelEkleModal()">+ Ekle</span></div>
    ${S.personel.filter(p=>p.aktif!==false).map(p=>`
      <div class="card" style="display:flex;align-items:center;gap:12px;margin-bottom:8px;cursor:pointer" onclick="personelDetay('${p.id}')">
        <div style="width:38px;height:38px;border-radius:10px;background:rgba(0,229,255,.1);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0">ğŸ‘¤</div>
        <div style="flex:1;min-width:0">
          <div style="font-size:13px;font-weight:600">${p.ad}</div>
          <div style="font-size:11px;color:var(--text2);margin-top:2px">${p.rol||'Operator'}</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:13px;font-weight:700;color:var(--accent)">â‚º${p.ucret||80}<span style="font-size:10px;color:var(--text3)">/s</span></div>
          <span class="badge badge-green" style="margin-top:4px">Aktif</span>
        </div>
      </div>`).join('')}
    <div style="height:20px"></div>
  </div>`;
}

function personelDetay(pid){
  const p=S.personel.find(x=>x.id==pid); if(!p) return;
  const mal=Object.values(S.maliyet||{}).filter(m=>m.personelId==pid);
  const saat=mal.reduce((s,m)=>s+(m.saat||0),0);
  const toplam=mal.reduce((s,m)=>s+(m.toplam||0),0);
  showModal(p.ad,`
    <div class="info-tr"><span class="info-k">Pozisyon</span><span class="info-v">${p.rol||'Operator'}</span></div>
    <div class="info-tr"><span class="info-k">Saatlik Ãœcret</span><span class="info-v" style="color:var(--accent)">â‚º${p.ucret||80}</span></div>
    <div class="info-tr"><span class="info-k">Toplam Ã‡alÄ±ÅŸma</span><span class="info-v">${saat.toFixed(1)} saat</span></div>
    <div class="info-tr"><span class="info-k">Toplam Maliyet</span><span class="info-v" style="color:var(--accent)">â‚º${Math.round(toplam).toLocaleString('tr')}</span></div>
    <button class="btn btn-outline btn-full" style="margin-top:16px" onclick="closeModal()">Kapat</button>
  `);
}

function personelEkleModal(){
  showModal('Personel Ekle',`
    <div class="form-row"><label class="f-label">Ad Soyad</label><input class="f-input" id="p-ad" placeholder="Ad Soyad..."></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="form-row"><label class="f-label">Pozisyon</label><select class="f-input" id="p-rol"><option>Operator</option><option>Forman</option></select></div>
      <div class="form-row"><label class="f-label">Saatlik Ãœcret</label><input class="f-input" type="number" id="p-ucret" value="80"></div>
    </div>
    <button class="btn btn-gold btn-full" onclick="kaydetPersonel()">Kaydet</button>
    <button class="btn btn-outline btn-full" style="margin-top:8px" onclick="closeModal()">Ä°ptal</button>
  `);
}

async function kaydetPersonel(){
  const ad=document.getElementById('p-ad').value.trim();
  if(!ad){showToast('Ad Soyad zorunlu!',false);return;}
  showLoading(true);
  try{
    const id=Date.now();
    const p={id,ad,rol:document.getElementById('p-rol').value,ucret:parseInt(document.getElementById('p-ucret').value)||80,aktif:true};
    await set(ref(db,`personel/${id}`),p);
    S.personel.push(p);
    
    // Forman rolÃ¼nde ise formanlar listesine de ekle
    if(p.rol==='Forman'){
      await set(ref(db,`formanlar/F${id}`),{ad:p.ad});
    }
    
    closeModal(); showToast(`${ad} eklendi âœ“`); goTab('personel');
  }catch(e){showToast('KayÄ±t hatasÄ±!',false);}
  showLoading(false);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RAPORLAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderRaporlar(body){
  const malSnap=await get(ref(db,'maliyet'));
  S.maliyet=malSnap.exists()?malSnap.val():{};
  const tumGirisSnap=await get(ref(db,'gunlukGiris'));
  const tumGiris=tumGirisSnap.exists()?tumGirisSnap.val():{};
  const tumIsler=Object.values(tumGiris).flatMap(gd=>Object.values(gd)).flatMap(g=>Object.values(g.isler||{}));
  const tumUretim=tumIsler.reduce((s,i)=>s+(i.gerceklesen||0),0);
  const tumMal=Object.values(S.maliyet).reduce((s,m)=>s+(m.toplam||0),0);
  const gunSayisi=Object.keys(tumGiris).length;

  body.innerHTML=`
  <div class="fade-up">
    <div class="sec-title">Genel Ã–zet</div>
    <div class="stats-row">
      <div class="stat-box gold"><div class="stat-num">${tumUretim.toLocaleString('tr')}</div><div class="stat-lbl">Toplam Ãœretim</div></div>
      <div class="stat-box cyan"><div class="stat-num" style="font-size:18px">â‚º${(tumMal/1000).toFixed(1)}K</div><div class="stat-lbl">Toplam Maliyet</div></div>
      <div class="stat-box green"><div class="stat-num">${gunSayisi}</div><div class="stat-lbl">Aktif GÃ¼n</div></div>
      <div class="stat-box purple"><div class="stat-num">${S.siparisler.filter(s=>s.durum==='TamamlandÄ±').length}/${S.siparisler.length}</div><div class="stat-lbl">Tamamlanan</div></div>
    </div>

    <div class="sec-title">SipariÅŸ PerformansÄ±</div>
    <div class="card" style="padding:0;overflow:hidden">
      <table class="tbl">
        <tr><th>SipariÅŸ</th><th>ÃœrÃ¼n</th><th>Hedef</th><th>Ãœretilen</th><th>%</th></tr>
        ${S.siparisler.map(s=>{
          const u=tumIsler.filter(i=>i.siparis===s.id).reduce((sum,i)=>sum+(i.gerceklesen||0),0);
          const pct=s.toplam>0?Math.min(Math.round(u/s.toplam*100),100):0;
          return `<tr>
            <td style="font-family:'JetBrains Mono',monospace;font-size:11px">${s.id}</td>
            <td style="font-size:12px">${s.urun}</td>
            <td style="font-family:'JetBrains Mono',monospace">${s.toplam}</td>
            <td style="font-family:'JetBrains Mono',monospace;color:var(--accent2)">${u}</td>
            <td><span class="badge ${pct>=100?'badge-green':'badge-gold'}">${pct}%</span></td>
          </tr>`;}).join('')||'<tr><td colspan="5" style="text-align:center;color:var(--text3);padding:20px">Veri yok</td></tr>'}
      </table>
    </div>

    <div class="sec-title">Personel Maliyet</div>
    <div class="card" style="padding:0;overflow:hidden">
      <table class="tbl">
        <tr><th>Personel</th><th>Saat</th><th>Maliyet</th></tr>
        ${S.personel.map(p=>{
          const pm=Object.values(S.maliyet).filter(m=>m.personelId==p.id);
          const saat=pm.reduce((s,m)=>s+(m.saat||0),0);
          const mal=pm.reduce((s,m)=>s+(m.toplam||0),0);
          return saat>0?`<tr><td style="font-size:12px">${p.ad}</td><td style="font-family:'JetBrains Mono',monospace">${saat.toFixed(1)}</td><td style="font-family:'JetBrains Mono',monospace;color:var(--accent)">â‚º${Math.round(mal).toLocaleString('tr')}</td></tr>`:'';
        }).join('')||'<tr><td colspan="3" style="text-align:center;color:var(--text3);padding:20px">Veri yok</td></tr>'}
      </table>
    </div>
    <div style="height:20px"></div>
  </div>`;
}

// Global
window.doLogin=doLogin; window.doLogout=doLogout; window.goTab=goTab;
window.formanDetay=formanDetay; window.siparisDetay=siparisDetay; window.durumDegistir=durumDegistir;
window.siparisEkleModal=siparisEkleModal; window.toggleATag=toggleATag; window.kaydetSiparis=kaydetSiparis;
window.isEkleModal=isEkleModal; window.isEkleModalSiparis=isEkleModalSiparis;
window.kaydetIsPlan=kaydetIsPlan; window.isPlaniSil=isPlaniSil;
window.personelDetay=personelDetay; window.personelEkleModal=personelEkleModal; window.kaydetPersonel=kaydetPersonel;

init();
</script>

<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--bg:#0a0f1a;--bg2:#0d1520;--bg3:#111d2e;--card:#0f1e30;--accent:#f0a500;--accent2:#00e5ff;--accent3:#7c3aed;--success:#00c853;--danger:#ff3d57;--warn:#ff9100;--text:#eef2f7;--text2:#7a9ab5;--text3:#3d5a73;--border:#1a2d42;--border2:#223348;--radius:14px;--radius-sm:9px}
html,body{height:100%;overflow:hidden;background:var(--bg);font-family:'Syne',sans-serif;color:var(--text)}
#app{height:100vh;display:flex;flex-direction:column;overflow:hidden}
.screen{position:absolute;inset:0;display:flex;flex-direction:column;background:var(--bg);transition:transform .3s cubic-bezier(.4,0,.2,1),opacity .3s}
.screen.hidden{transform:translateX(100%);pointer-events:none;opacity:0}
.screen.out{transform:translateX(-30%);pointer-events:none;opacity:0}
#login{justify-content:flex-end;background:var(--bg)}
.login-bg{position:absolute;inset:0;background-image:linear-gradient(rgba(26,45,66,.2) 1px,transparent 1px),linear-gradient(90deg,rgba(26,45,66,.2) 1px,transparent 1px);background-size:40px 40px}
.login-bg::before{content:'';position:absolute;width:500px;height:500px;background:radial-gradient(circle,rgba(240,165,0,.12) 0%,transparent 65%);top:-100px;right:-100px}
.login-panel{position:relative;z-index:1;background:linear-gradient(180deg,rgba(13,21,32,.97) 0%,var(--bg) 100%);border-top:1px solid var(--border2);border-radius:24px 24px 0 0;padding:28px 20px env(safe-area-inset-bottom,32px)}
.f-label{font-size:10px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.7px;margin-bottom:7px;display:block}
.f-input{width:100%;background:var(--bg3);border:1.5px solid var(--border2);border-radius:var(--radius-sm);padding:13px 14px;color:var(--text);font-family:'Syne',sans-serif;font-size:14px;outline:none;transition:border-color .2s;margin-bottom:14px}
.f-input:focus{border-color:var(--accent)}
select.f-input{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%237a9ab5' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:38px}
.topbar{background:var(--bg2);border-bottom:1px solid var(--border);padding:0 16px;height:56px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;z-index:20}
.tb-title{font-size:15px;font-weight:700}.tb-sub{font-size:10px;color:var(--text2)}
.bottom-nav{background:var(--bg2);border-top:1px solid var(--border);display:flex;flex-shrink:0;padding-bottom:env(safe-area-inset-bottom,0px)}
.nav-item{flex:1;padding:10px 4px 8px;display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;border:none;background:none;color:var(--text3);transition:color .2s;position:relative}
.nav-item.active{color:var(--accent)}
.nav-item.active::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:20px;height:2px;background:var(--accent);border-radius:1px}
.nav-icon{font-size:20px;line-height:1}.nav-label{font-size:9px;font-weight:700;letter-spacing:.4px;text-transform:uppercase}
.screen-body{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding:14px;display:flex;flex-direction:column;gap:10px}
.screen-body::-webkit-scrollbar{display:none}
.sec-title{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.9px;display:flex;align-items:center;justify-content:space-between;padding:2px 0}
.sec-action{font-size:11px;font-weight:700;color:var(--accent);cursor:pointer;text-transform:none;letter-spacing:0}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px;position:relative;overflow:hidden}
.stats-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.stat-box{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:12px;position:relative;overflow:hidden}
.stat-box::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.stat-box.gold::before{background:var(--accent)}.stat-box.cyan::before{background:var(--accent2)}.stat-box.green::before{background:var(--success)}.stat-box.yellow::before{background:#ffd700}.stat-box.purple::before{background:var(--accent3)}
.stat-num{font-size:26px;font-weight:800;font-family:'JetBrains Mono',monospace;letter-spacing:-1px}.stat-lbl{font-size:10px;color:var(--text2);margin-top:3px}
.prog-wrap{background:var(--bg3);border-radius:3px;height:4px;overflow:hidden;margin-top:6px}
.prog-bar{height:100%;border-radius:3px;transition:width .6s}
.prog-bar.gold{background:linear-gradient(90deg,var(--accent),#ff8c00)}.prog-bar.cyan{background:linear-gradient(90deg,var(--accent2),#0099cc)}.prog-bar.green{background:linear-gradient(90deg,var(--success),#00a844)}
.badge{display:inline-flex;align-items:center;padding:3px 9px;border-radius:20px;font-size:10px;font-weight:700}
.badge-gold{background:rgba(240,165,0,.15);color:var(--accent)}.badge-cyan{background:rgba(0,229,255,.15);color:var(--accent2)}.badge-green{background:rgba(0,200,83,.15);color:var(--success)}.badge-red{background:rgba(255,61,87,.15);color:var(--danger)}.badge-gray{background:rgba(61,90,115,.3);color:var(--text2)}
.info-tr{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(26,45,66,.5)}
.info-tr:last-child{border-bottom:none}.info-k{font-size:12px;color:var(--text2)}.info-v{font-size:12px;font-weight:600;text-align:right}
.btn{display:flex;align-items:center;justify-content:center;gap:8px;border:none;border-radius:var(--radius-sm);font-family:'Syne',sans-serif;font-weight:700;cursor:pointer;transition:transform .1s;letter-spacing:.2px}
.btn:active{transform:scale(.97)}.btn-full{width:100%}
.btn-gold{background:linear-gradient(135deg,var(--accent),#c87f00);color:#0a0f1a;font-size:14px;padding:14px;box-shadow:0 4px 20px rgba(240,165,0,.25)}
.btn-cyan{background:linear-gradient(135deg,var(--accent2),#0099cc);color:#0a0f1a;font-size:14px;padding:14px}
.btn-outline{background:transparent;border:1.5px solid var(--border2);color:var(--text2);font-size:13px;padding:12px}
.tag-group{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px}
.tag{padding:8px 14px;border-radius:20px;border:1.5px solid var(--border2);font-size:12px;font-weight:600;cursor:pointer;transition:all .15s;background:var(--bg3);color:var(--text2)}
.tag.selected{border-color:var(--accent);background:rgba(240,165,0,.1);color:var(--accent)}
.form-row{margin-bottom:12px}
.tbl{width:100%;border-collapse:collapse;font-size:12px}
.tbl th{background:var(--bg3);color:var(--text2);font-weight:700;padding:9px 8px;text-align:left;font-size:10px;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--border)}
.tbl td{padding:10px 8px;border-bottom:1px solid rgba(26,45,66,.4);vertical-align:middle}
.tbl tr:last-child td{border-bottom:none}
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center;gap:8px}
.empty-icon{font-size:40px;opacity:.4}.empty-text{font-size:14px;color:var(--text2)}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:200;display:flex;align-items:flex-end;opacity:0;pointer-events:none;transition:opacity .25s;backdrop-filter:blur(4px)}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal-sheet{background:var(--bg2);border-radius:22px 22px 0 0;border-top:1px solid var(--border2);padding:20px 18px env(safe-area-inset-bottom,28px);width:100%;max-height:90vh;overflow-y:auto;transform:translateY(100%);transition:transform .32s cubic-bezier(.4,0,.2,1)}
.modal-overlay.open .modal-sheet{transform:translateY(0)}
.modal-handle{width:36px;height:3px;background:var(--border2);border-radius:2px;margin:0 auto 16px}
.modal-title{font-size:16px;font-weight:800;margin-bottom:14px}
.toast{position:fixed;bottom:84px;left:50%;transform:translateX(-50%) translateY(10px);color:#0a0f1a;font-weight:800;font-size:13px;padding:11px 22px;border-radius:24px;opacity:0;transition:all .25s;z-index:300;white-space:nowrap;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
#loading{position:fixed;inset:0;background:rgba(5,10,20,.85);z-index:500;display:none;align-items:center;justify-content:center;flex-direction:column;gap:12px;backdrop-filter:blur(4px)}
.spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.fade-up{animation:fadeUp .2s ease forwards}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
</style>
</head>
<body>
<div id="app">
<div id="loading"><div class="spinner"></div><div style="font-size:13px;color:var(--text2)">YÃ¼kleniyor...</div></div>

<div class="screen" id="login">
  <div class="login-bg"></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;position:relative;z-index:1">
    <div style="text-align:center">
      <div style="font-size:52px;margin-bottom:12px">ğŸ­</div>
      <div style="font-size:26px;font-weight:800;letter-spacing:-1px;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent">Ãœretim Takip</div>
      <div style="font-size:12px;color:var(--text2);margin-top:6px">YÃ¶netici Paneli Â· Online</div>
    </div>
  </div>
  <div class="login-panel">
    <div style="margin-bottom:14px">
      <label class="f-label">GiriÅŸ Yapan</label>
      <select class="f-input" id="login-user" style="margin-bottom:0"></select>
    </div>
    <button style="width:100%;background:linear-gradient(135deg,var(--accent),#c87f00);color:#0a0f1a;font-family:'Syne',sans-serif;font-size:15px;font-weight:800;border:none;border-radius:var(--radius-sm);padding:16px;cursor:pointer;box-shadow:0 4px 20px rgba(240,165,0,.3)" onclick="doLogin()">Panele GiriÅŸ Yap â†’</button>
  </div>
</div>

<div class="screen hidden" id="main">
  <div class="topbar">
    <div><div class="tb-title" id="tb-user">YÃ¶netici</div><div class="tb-sub" id="tb-date">â€”</div></div>
    <div style="display:flex;align-items:center;gap:8px">
      <div style="display:flex;align-items:center;gap:4px;font-size:10px;color:var(--success);font-weight:700"><span style="width:6px;height:6px;border-radius:50%;background:var(--success);animation:blink 1.5s infinite"></span>CANLI</div>
      <button onclick="doLogout()" style="background:none;border:1.5px solid var(--border2);color:var(--text2);border-radius:8px;padding:5px 10px;font-family:'Syne',sans-serif;font-size:11px;font-weight:700;cursor:pointer">Ã‡Ä±kÄ±ÅŸ</button>
    </div>
  </div>
  <div class="screen-body" id="main-body"></div>
  <div class="bottom-nav">
    <button class="nav-item active" id="nav-dashboard" onclick="goTab('dashboard')"><span class="nav-icon">ğŸ </span><span class="nav-label">Panel</span></button>
    <button class="nav-item" id="nav-siparisler" onclick="goTab('siparisler')"><span class="nav-icon">ğŸ“¦</span><span class="nav-label">SipariÅŸler</span></button>
    <button class="nav-item" id="nav-isplani" onclick="goTab('isplani')"><span class="nav-icon">ğŸ“‹</span><span class="nav-label">Ä°ÅŸ PlanÄ±</span></button>
    <button class="nav-item" id="nav-personel" onclick="goTab('personel')"><span class="nav-icon">ğŸ‘¥</span><span class="nav-label">Personel</span></button>
    <button class="nav-item" id="nav-raporlar" onclick="goTab('raporlar')"><span class="nav-icon">ğŸ“Š</span><span class="nav-label">Raporlar</span></button>
  </div>
</div>

<div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal-sheet"><div class="modal-handle"></div><div class="modal-title" id="modal-title"></div><div id="modal-body"></div></div>
</div>
<div class="toast" id="toast"></div>
</div>
</body>
</html>
